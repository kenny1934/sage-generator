<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAGE: Secondary Academy Generator of Exercises ‚ú®</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- KaTeX CSS for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" xintegrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
    <!-- KaTeX JS for math rendering -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" xintegrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    
    <!-- Google APIs for Drive integration (optional) -->
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- SAGE CSS Files -->
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/main.css">

    <!-- All CSS is now in external files -->
    
    <!-- SAGE JavaScript Files -->
    <script src="js/config.js"></script>
    <script src="js/classes/ResponsiveLayoutManager.js"></script>
    <script src="js/classes/DataManager.js"></script>
    <script src="js/classes/QuestionCache.js"></script>
    <script src="js/classes/CelebrationEngine.js"></script>
    <script src="js/classes/SwipeHandler.js"></script>
    <script src="js/classes/MathBackground.js"></script>
    <script src="js/classes/DataExportManager.js"></script>
    <script src="js/classes/TopicRecommendationEngine.js"></script>
    <script src="js/utils/mathUtils.js"></script>
    <script src="js/utils/domUtils.js"></script>
    <script src="js/utils/apiUtils.js"></script>
    <script src="js/utils/validationUtils.js"></script>
    <script src="js/components/statsDisplay.js"></script>
    <script src="js/components/questionDisplay.js"></script>
    <script src="js/components/topicSuggestions.js"></script>
    <script src="js/components/notifications.js"></script>
    <script src="js/main.js"></script>
</head>
<body>
    <div class="app-layout">
        <!-- App Header -->
        <header class="app-header">
            <!-- Left: Logo & Branding -->
            <div class="header-left">
                <img src="./images/msa-logo.png" alt="MSA Logo" class="logo" onerror="this.onerror=null;this.src='https://placehold.co/100x100/ffffff/dc2626?text=Logo';">
                <div class="header-text">
                    <h1 class="sage-title">SAGE</h1>
                    <div class="divider"></div>
                    <div class="full-name">
                        <span class="em">S</span>econdary <span class="em">A</span>cademy <span class="em">G</span>enerator of <span class="em">E</span>xercises
                    </div>
                </div>
            </div>
            
            <!-- Right: Theme Toggle -->
            <div class="header-right">
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
        </header>


        <!-- Main Content Area -->
        <div class="app-main">
            <!-- Left Config Panel -->
            <aside class="config-panel main-container">
                <div class="config-content">
                    <!-- Configuration sections will go here -->

            
            <!-- Google Drive Setup (hidden by default) -->
            <div id="googleDriveSetupPanel" class="mb-6 p-4 bg-blue-900/20 border border-blue-600/30 rounded-lg hidden">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-semibold text-blue-200">
                        ‚òÅÔ∏è Google Drive Setup
                    </h3>
                    <button type="button" class="text-blue-400 hover:text-blue-300 text-sm" onclick="hideGoogleDriveSetup()">Close</button>
                </div>
                <div class="text-sm text-blue-200 mb-4">
                    <p class="mb-2">Enable multi-device sync for your Google Workspace:</p>
                    <ol class="list-decimal list-inside space-y-1 text-blue-300 text-xs">
                        <li>Go to <a href="https://console.cloud.google.com" target="_blank" class="text-blue-400 underline">Google Cloud Console</a></li>
                        <li>Enable the Google Drive API</li>
                        <li>Create OAuth 2.0 Client ID (Web application)</li>
                        <li>Add <code class="bg-gray-700 px-1 rounded text-blue-200" id="currentOriginDisplay">your current URL</code> to "Authorized JavaScript origins"</li>
                        <li>Enter Client ID below</li>
                    </ol>
                </div>
                <div class="grid grid-cols-1 gap-3">
                    <div>
                        <label for="googleClientId" class="block text-sm font-medium text-blue-200 mb-1">Google OAuth Client ID:</label>
                        <input type="text" id="googleClientId" class="w-full p-2 text-sm bg-gray-800 border border-blue-500 rounded" placeholder="123456789-abcdefg.apps.googleusercontent.com">
                    </div>
                    <button type="button" class="action-btn bg-blue-600 hover:bg-blue-700 text-sm" onclick="saveGoogleDriveConfig()">
                        Save Configuration
                    </button>
                </div>
            </div>

            <!-- API Key Configuration -->
            <div id="apiKeyContainer" class="api-key-container">
                <label for="apiKeyInput" class="block text-sm font-semibold text-gray-200 mb-2">
                    Gemini API Key (required):
                </label>
                <div class="flex gap-2">
                    <input type="password" id="apiKeyInput" class="flex-1" placeholder="Enter your Gemini API key" aria-label="Gemini API Key">
                    <button id="saveApiKeyBtn" class="action-btn bg-red-600 hover:bg-red-700" aria-label="Save API Key">
                        Save
                    </button>
                </div>
                <p class="text-xs text-gray-400 mt-1">
                    Your API key is stored locally and never sent to our servers.
                </p>
            </div>
            

            <div class="space-y-8">

                <div>
                    <label for="mathTopic" class="block text-lg font-semibold mb-2">
                        Maths Topic & Grade Level <span class="text-gray-400 text-sm">(e.g., "Algebra for Grade 7", "Trigonometry for Form 3")</span>:
                    </label>
                    <div class="autocomplete-container">
                        <textarea id="mathTopic" rows="3" class="w-full p-3 shadow-sm" placeholder="e.g., 'Solving linear equations in one unknown for F1', 'Complex number problems for Form 4'" aria-label="Maths Topic and Grade Level"></textarea>
                        <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
                    </div>
                </div>

                <div>
                    <label for="difficulty" class="block text-lg font-semibold mb-2">
                        Difficulty Level:
                    </label>
                    <select id="difficulty" class="w-full p-3 shadow-sm" aria-label="Difficulty Level">
                        <option value="Easy">Easy</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="Hard">Hard</option>
                        <option value="Challenging">Challenging</option>
                    </select>
                    <div id="difficultyDescription" class="difficulty-description">
                        Medium complexity with step-by-step explanations
                    </div>
                </div>

                <button id="generateQuestionsBtn" class="w-full bg-red-600 text-white font-extrabold py-4 px-6 rounded-xl hover:bg-red-700 transition-all duration-300 ease-in-out shadow-lg transform hover:-translate-y-1 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-400 flex items-center justify-center text-xl" aria-label="Generate Math Questions">
                    Generate Maths Questions! ‚ûï
                </button>

                <div id="loadingIndicator" class="hidden text-center mt-6" role="status" aria-live="polite">
                    <div class="math-spinner justify-center">
                        <span class="math-symbol">œÄ</span>
                        <span class="math-symbol">‚àë</span>
                        <span class="math-symbol">‚à´</span>
                        <span class="math-symbol">‚àû</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div id="loadingMessage" class="loading-message">Initializing math generator...</div>
                </div>

                <div id="questionsContainer" class="hidden mt-10 border-t-2 border-gray-700 pt-10">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
                        <h2 class="text-3xl font-bold text-center sm:text-left flex-grow" style="color: var(--text-primary);">Your Generated Questions</h2>
                        <div class="flex gap-2 flex-wrap">
                            <button id="exportQuestionsBtn" class="action-btn bg-red-500 hover:bg-red-600 text-sm sm:text-base" aria-label="Export questions to text file">
                                Export Questions
                            </button>
                            <button id="showFavoritesBtn" class="action-btn bg-yellow-600 hover:bg-yellow-700 text-sm sm:text-base" aria-label="View your favorite questions" onclick="showFavoritesPanel()">
                                ‚≠ê Favorites
                            </button>
                            <button id="toggleMathViewBtn" class="action-btn bg-gray-500 hover:bg-gray-600 text-sm sm:text-base" aria-label="Toggle between rendered math and raw LaTeX view">
                                Toggle Maths View (Rendered)
                            </button>
                        </div>
                    </div>
                    
                    <!-- Question Navigator -->
                    <div id="questionNavigator" class="question-navigator hidden">
                        <button id="prevQuestionBtn" class="nav-button" aria-label="Previous question">
                            ‚Üê Previous
                        </button>
                        <div class="question-counter" id="questionCounter">
                            Question 1 of 3
                        </div>
                        <button id="nextQuestionBtn" class="nav-button" aria-label="Next question">
                            Next ‚Üí
                        </button>
                    </div>
                    
                    <div id="mathQuestionsList" class="space-y-8" role="list">
                        <!-- Math questions will be inserted here -->
                    </div>
                    <button id="resetBtn" class="hidden w-full bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-700 transition-all duration-300 ease-in-out shadow-lg transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-400 mt-8" aria-label="Generate New Questions">
                        Generate New Questions
                    </button>
                </div>

                <div id="messageContainer" class="mt-8" role="alert" aria-live="polite">
                    <p class="text-gray-400 text-center" id="initialMessage">Your generated maths questions will appear here.</p>
                </div>

                <!-- Phase 4: Data Management Section -->
                <div id="dataManagementContainer" class="mt-8 p-4 rounded-lg" style="background: var(--surface); border: 1px solid var(--border-color);">
                    <h3 class="text-lg font-semibold mb-3" style="color: var(--text-primary);">Data Management</h3>
                    <div class="flex gap-2 flex-wrap mb-3">
                        <button id="exportDataBtn" class="action-btn text-sm px-3 py-2 rounded transition-colors" 
                                style="background: #059669; border: 1px solid #047857; color: white;"
                                onmouseover="this.style.background='#047857'" 
                                onmouseout="this.style.background='#059669'">
                            üì¶ Export All Data
                        </button>
                        <button id="importDataBtn" class="action-btn text-sm px-3 py-2 rounded transition-colors"
                                style="background: #2563eb; border: 1px solid #1d4ed8; color: white;"
                                onmouseover="this.style.background='#1d4ed8'" 
                                onmouseout="this.style.background='#2563eb'">
                            üì• Import Data
                        </button>
                        <button id="clearDataBtn" class="action-btn text-sm px-3 py-2 rounded transition-colors"
                                style="background: #dc2626; border: 1px solid #b91c1c; color: white;"
                                onmouseover="this.style.background='#b91c1c'" 
                                onmouseout="this.style.background='#dc2626'">
                            üóëÔ∏è Clear All
                        </button>
                    </div>
                    <input type="file" id="importFileInput" class="hidden" accept=".json">
                    <p class="text-xs" style="color: var(--text-muted);">
                        Export your preferences, history, favorites, streaks, and stats for backup or transfer between devices.
                    </p>
                </div>
            </div>
                </div>
            </aside>

            <!-- Right Questions Canvas -->
            <main class="questions-canvas main-container" id="questions-canvas">
                <div class="questions-content">
                    <!-- Questions will be displayed here -->
                    <p class="text-gray-400 text-center" id="questionsPlaceholder">Select a topic and generate questions to see them here.</p>
                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 MathConcept Secondary Academy. All Rights Reserved.</p>
        </footer>
    </div>

    <script>
        // Note: Main initialization functions moved to js/main.js
        // Note: Component functions moved to js/components/
        // Note: Utility functions moved to js/utils/
        // Note: Class definitions moved to js/classes/
        
        // All application logic now properly modularized for maintainability
        // The main.js file handles all initialization when DOM is loaded
        // All main application logic has been moved to js/main.js and component files
        // This ensures better code organization, maintainability, and performance
    </script>
</body>
</html>
